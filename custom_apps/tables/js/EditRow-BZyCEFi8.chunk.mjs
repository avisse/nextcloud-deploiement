const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=[window.OC.filePath('tables', '', 'js/store-Cvxj8Vav.chunk.mjs'),window.OC.filePath('tables', '', 'js/constants-C1shV9FP.chunk.mjs'),window.OC.filePath('tables', '', 'js/vue.runtime.esm-DBajT-mq.chunk.mjs'),window.OC.filePath('tables', '', 'js/_plugin-vue2_normalizer-jrlE7CJU-B-cIoeGj.chunk.mjs'),window.OC.filePath('tables', '', 'js/NcNoteCard-DG3F-LUj.chunk.mjs'),window.OC.filePath('tables', '', 'js/index-BmkWHhSR.chunk.mjs')])))=>i.map(i=>d[i]);
/*! third party licenses: js/vendor.LICENSE.txt */
import{_ as r}from"./preload-helper-DI1sXkNj.chunk.mjs";import{f as n}from"./useFormatDateTime-AjHnUuIE.chunk.mjs";import{i as a,l as c,f as d}from"./NcNoteCard-DG3F-LUj.chunk.mjs";import{n as u}from"./_plugin-vue2_normalizer-oRdohoZe.chunk.mjs";import"./index-BmkWHhSR.chunk.mjs";import"./index-56SXuvlv-Ca_OzF4R.chunk.mjs";import{s as l}from"./_plugin-vue2_normalizer-jrlE7CJU-B-cIoeGj.chunk.mjs";/* empty css                     */import{r as w,a as m}from"./rowHelper-CqVeo9j1.chunk.mjs";import{p as h}from"./NcTable-BKzW_OCJ.chunk.mjs";import{m as i,A as p}from"./constants-C1shV9FP.chunk.mjs";import{useTablesStore as y}from"./store-Cvxj8Vav.chunk.mjs";import{u as f}from"./data-BYdwMvxA.chunk.mjs";import"./vue.runtime.esm-DBajT-mq.chunk.mjs";import"./public-0fz1q1qH.chunk.mjs";import"./RowFormWrapper-CzNjoOJe.chunk.mjs";import"./Link-BMMtnqd-.chunk.mjs";const R={name:"EditRow",components:{NcDialog:n,NcButton:d,ColumnFormComponent:m,NcNoteCard:c},mixins:[h,w],props:{showModal:{type:Boolean,default:!1},columns:{type:Array,default:null},row:{type:Object,default:null},isView:{type:Boolean,default:!1},element:{type:Object,default:null}},data(){return{localRow:null,prepareDeleteRow:!1,localLoading:!1,allowedProtocols:p}},computed:{showDeleteButton(){return this.canDeleteData(this.element)&&!this.localLoading},nonMetaColumns(){return this.columns.filter(t=>t.id>=0)},hasEmptyMandatoryRows(){return this.checkMandatoryFields(this.localRow)},hasInvalidUrlProtocol(){return this.nonMetaColumns.some(t=>t.type==="text-link"&&!this.isValidUrlProtocol(this.localRow[t.id]))}},watch:{row(){this.row&&(this.$router.currentRoute.path.includes("/row/")&&this.$router.replace(this.$router.currentRoute.path.split("/row/")[0]),this.$router.push(this.$router.currentRoute.path+"/row/"+this.row.id),this.setActiveRowId(null),this.loadValues())}},mounted(){this.loadValues()},methods:{...i(f,["updateRow","removeRow"]),...i(y,["setActiveRowId"]),t:a,loadValues(){if(this.row){const t={};this.row.data.forEach(e=>{t[e.columnId]=e.value}),this.localRow=Object.assign({},t)}},actionCancel(){this.$router?.back(),this.reset(),this.$emit("close")},async actionConfirm(){this.localLoading=!0,await this.sendRowToBE(),this.localLoading=!1,this.actionCancel()},async sendRowToBE(){await this.loadStore();const t=[];for(const[e,o]of Object.entries(this.localRow))t.push({columnId:e,value:o??""});await this.updateRow({id:this.row.id,isView:this.isView,elementId:this.element.id,data:t})||l(a("tables","Could not update row"))},reset(){this.localRow={},this.dataLoaded=!1,this.prepareDeleteRow=!1},actionDeleteRow(){this.deleteRowAtBE(this.row.id)},async deleteRowAtBE(t){await this.loadStore(),this.localLoading=!0,await this.removeRow({rowId:t,isView:this.isView,elementId:this.element.id})||l(a("tables","Could not delete row.")),this.localLoading=!1,this.actionCancel()},async loadStore(){if(this.tablesStore)return;const{default:t}=await r(async()=>{const{default:e}=await import("./store-Cvxj8Vav.chunk.mjs");return{default:e}},__vite__mapDeps([0,1,2,3,4,5]),import.meta.url);this.tablesStore=t},onKeydown(t){t.key==="Enter"&&t.ctrlKey&&this.actionConfirm()}}};var _=function(){var t=this,e=t._self._c;return t.showModal?e("NcDialog",{attrs:{"data-cy":"editRowModal",name:t.t("tables","Edit row"),size:"large"},on:{closing:t.actionCancel}},[e("div",{staticClass:"modal__content",on:{keydown:t.onKeydown}},[t._l(t.nonMetaColumns,function(o){return e("div",{key:o.id},[e("ColumnFormComponent",{attrs:{column:o,value:t.localRow[o.id]},on:{"update:value":function(s){return t.$set(t.localRow,o.id,s)}}}),o.mandatory&&!t.isValueValidForColumn(t.localRow[o.id],o)?e("NcNoteCard",{attrs:{type:"error"}},[t._v(" "+t._s(t.t("tables",'"{columnTitle}" should not be empty',{columnTitle:o.title}))+" ")]):t._e(),t.localRow[o.id]&&o.type==="text-link"&&!t.isValidUrlProtocol(t.localRow[o.id])?e("NcNoteCard",{attrs:{type:"error"}},[t._v(" "+t._s(t.t("tables","Invalid protocol. Allowed: {allowed}",{allowed:t.allowedProtocols.join(", ")}))+" ")]):t._e()],1)}),e("div",{staticClass:"row"},[e("div",{staticClass:"fix-col-4 space-T",class:{"justify-between":t.showDeleteButton,end:!t.showDeleteButton}},[t.showDeleteButton?e("div",[t.prepareDeleteRow?t._e():e("NcButton",{attrs:{"aria-label":t.t("tables","Delete"),type:"error","data-cy":"editRowDeleteButton"},on:{click:function(o){t.prepareDeleteRow=!0}}},[t._v(" "+t._s(t.t("tables","Delete"))+" ")]),t.prepareDeleteRow?e("NcButton",{attrs:{"data-cy":"editRowDeleteConfirmButton",wide:!0,"aria-label":t.t("tables","I really want to delete this row!"),type:"error"},on:{click:t.actionDeleteRow}},[t._v(" "+t._s(t.t("tables","I really want to delete this row!"))+" ")]):t._e()],1):t._e(),t.canUpdateData(t.element)&&!t.localLoading?e("NcButton",{attrs:{"aria-label":t.t("tables","Save"),type:"primary","data-cy":"editRowSaveButton",disabled:t.hasEmptyMandatoryRows||t.hasInvalidUrlProtocol},on:{click:t.actionConfirm}},[t._v(" "+t._s(t.t("tables","Save"))+" ")]):t._e(),t.localLoading?e("div",{staticClass:"icon-loading",staticStyle:{"margin-left":"20px"}}):t._e()],1)])],2)]):t._e()},v=[],b=u(R,_,v,!1,null,"935aecb4");const j=b.exports;export{j as default};
//# sourceMappingURL=EditRow-BZyCEFi8.chunk.mjs.map
