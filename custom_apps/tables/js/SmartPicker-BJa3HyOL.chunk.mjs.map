{"version":3,"mappings":";;qxBA+CA,MAAAA,EAAA,CAEA,YACA,SAAAC,EACA,sBAAAC,CACA,EAEA,OACA,OACA,YACA,YACA,CACA,EAEA,OACA,OACA,WACA,UACA,UACA,CACA,EAEA,UACA,aACA,8BAAAC,EAAAC,IAAAD,EAAA,QAAAC,EAAA,QACA,EACA,YACA,MACA,iBACA,EACA,IAAAC,EAAA,CACA,0BAAAA,CAAA,CACA,CACA,CACA,EAEA,OACA,OACA,qBACA,CACA,EAEA,UAEA,EAEA,SACA,EAAAC,EACA,0BACA,gBAEA,IACA,MAAAC,EAAA,MAAAC,EAAA,IAAAC,EAAA,4CACA,oBAAAF,CAAA,EACA,aAAAA,EAAA,IACA,OAAAG,EAAA,CACAC,EAAAD,EAAAJ,EAAA,2CACA,CAEA,eACA,EACA,aACA,sBACA,8BAEA,EACA,eAAAM,EAAA,WACA,WACA,MACA,CAEA,i4BClGAZ,EAAA,CACA,iBACA,gBACA,OACA,OACA,WACA,EACA,WACA,YACA,sBACA,EACA,MACA,YACA,UACA,CACA,CACA,kjBC0CAA,EAAA,CAEA,YACA,WAAAa,EACA,SAAAC,EACA,SAAAC,EACA,UAAAC,EACA,eAAAC,EACA,OAAAC,EACA,sBAAAC,EACA,SAAAC,EACA,oBAAAC,EAAA,6GACA,uBAAAA,EAAA,sIACA,cAAAC,CACA,EAEA,QAEA,mBADAC,EAAA,CACA,CACA,EAEA,OACA,OACA,kBACA,WACA,kBACA,aACA,CACA,EAEA,UACA,UACA,eACA,SAGA,MAAAC,EAAA,0CACA,0DAAAf,EAAA,yDAAAe,CAAA,CACA,CACA,EAEA,OACA,aACA,oBACA,EACA,QACA,wBACA,oBACA,CACA,EAEA,gBACA,sBACA,cAAAC,CAAA,kDACA,6CAAAA,CAAA,sDACA,SAAAC,CAAA,kDACA,yDAAAA,CAAA,sDAEA,iBAAAD,EACA,sBAAAC,CACA,CACA,EAEA,SACA,EAAApB,EACA,EAAAqB,EACA,sBACA,6BACA,uBAEA,0CACA,uCAEA,yBAEA,4BACA,+BAEA,EACA,kBACA,iCACA,EACA,mBACA,uCACA,kCACA,6DACA,2CACA,+CACA,uCACA,qCACA,mCACA,EACA,qCACA,qBAIA,IACA,MAAApB,EAAA,MAAAC,EAAA,IAAAC,EAAA,yEACA,gCAAAF,EAAA,MACA,wBAAAA,EAAA,IACA,OAAAG,EAAA,CACAC,EAAAD,EAAAJ,EAAA,yDACA,CACA,EACA,kCACA,qBAIA,IACA,MAAAC,EAAA,MAAAC,EAAA,IAAAC,EAAA,2DACA,6BAAAF,EAAA,MACA,qBAAAA,EAAA,IACA,OAAAG,EAAA,CACAC,EAAAD,EAAAJ,EAAA,sDACA,CACA,CACA,CAEA","names":["_sfc_main","NcSelect","SearchAndSelectOption","a","b","v","t","res","axios","generateUrl","e","displayError","debounce","IconTables","IconLink","IconText","IconCheck","NcEmptyContent","Search","NcCheckboxRadioSwitch","NcButton","__vitePreload","NcLoadingIcon","useTablesStore","suffix","store","data","n"],"ignoreList":[1],"sources":["../src/views/sections/Search.vue","../node_modules/vue-material-design-icons/Check.vue","../src/views/SmartPicker.vue"],"sourcesContent":["<!--\n  - SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<template>\n\t<div>\n\t\t<NcSelect\n\t\t\tid=\"smartpicker-select\"\n\t\t\tv-model=\"localValue\"\n\t\t\t:loading=\"loading\"\n\t\t\t:placeholder=\"t('tables', 'Search for table and views...')\"\n\t\t\t:aria-label-combobox=\"t('tables', 'Search for table and views...')\"\n\t\t\t:options=\"getOptions\"\n\t\t\t@search=\"v => term = v\">\n\t\t\t<template #option=\"props\">\n\t\t\t\t<SearchAndSelectOption\n\t\t\t\t\t:label=\"props.label\"\n\t\t\t\t\t:emoji=\"props.emoji\"\n\t\t\t\t\t:owner=\"props.owner\"\n\t\t\t\t\t:owner-display-name=\"props.ownerDisplayName\"\n\t\t\t\t\t:rows-count=\"props.rowsCount\"\n\t\t\t\t\t:type=\"props.type\"\n\t\t\t\t\t:subline=\"props.subline\" />\n\t\t\t</template>\n\t\t\t<template #selected-option=\"props\">\n\t\t\t\t<SearchAndSelectOption\n\t\t\t\t\t:label=\"props.label\"\n\t\t\t\t\t:emoji=\"props.emoji\"\n\t\t\t\t\t:owner=\"props.owner\"\n\t\t\t\t\t:owner-display-name=\"props.ownerDisplayName\"\n\t\t\t\t\t:rows-count=\"props.rowsCount\"\n\t\t\t\t\t:subline=\"props.subline\"\n\t\t\t\t\t:type=\"props.type\" />\n\t\t\t</template>\n\t\t</NcSelect>\n\t</div>\n</template>\n\n<script>\nimport { NcSelect } from '@nextcloud/vue'\nimport { translate as t } from '@nextcloud/l10n'\nimport SearchAndSelectOption from '../partials/SearchAndSelectOption.vue'\nimport debounce from 'debounce'\nimport axios from '@nextcloud/axios'\nimport { generateUrl } from '@nextcloud/router'\nimport displayError from '../../shared/utils/displayError.js'\n\nexport default {\n\n\tcomponents: {\n\t\tNcSelect,\n\t\tSearchAndSelectOption,\n\t},\n\n\tprops: {\n\t\tvalue: {\n\t\t      type: Object,\n\t\t      default: null,\n\t\t    },\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tloading: false,\n\t\t\tterm: null,\n\t\t\toptions: [],\n\t\t}\n\t},\n\n\tcomputed: {\n\t\tgetOptions() {\n\t\t\treturn [...this.options].sort((a, b) => a.quality - b.quality)\n\t\t},\n\t\tlocalValue: {\n\t\t\tget() {\n\t\t\t\treturn this.value\n\t\t\t},\n\t\t\tset(v) {\n\t\t\t\tthis.$emit('update:value', v)\n\t\t\t},\n\t\t},\n\t},\n\n\twatch: {\n\t\tterm() {\n\t\t\tthis.debounceSubmit()\n\t\t},\n\t},\n\n\tmounted() {\n\t\t// this.loadResultsFromBE()\n\t},\n\n\tmethods: {\n\t\tt,\n\t\tasync loadResultsFromBE() {\n\t\t\tthis.loading = true\n\n\t\t\ttry {\n\t\t\t\tconst res = await axios.get(generateUrl('/apps/tables/search/all?term=' + this.term))\n\t\t\t\tconsole.debug('res', res)\n\t\t\t\tthis.options = res.data\n\t\t\t} catch (e) {\n\t\t\t\tdisplayError(e, t('tables', 'Could not load search results.'))\n\t\t\t}\n\n\t\t\tthis.loading = false\n\t\t},\n\t\tasync load() {\n\t\t\tif (this.term?.length >= 3) {\n\t\t\t\tawait this.loadResultsFromBE()\n\t\t\t}\n\t\t},\n\t\tdebounceSubmit: debounce(function() {\n\t\t\tthis.load()\n\t\t}, 500),\n\t},\n\n}\n</script>\n\n<style lang=\"scss\" scoped>\n\n\t:deep(.v-select.select) {\n\t\twidth: 100%;\n\t}\n\n\t:deep(#smartpicker-select input[type=search]) {\n\t\theight: 41px;\n\t}\n\n\t:deep(#smartpicker-select .details) {\n\t\tdisplay: inline-flex;\n\t\talign-items: self-start;\n\t}\n\n\t:deep(#smartpicker-select .vs__selected-options) {\n\t\tpadding-top: calc(var(--default-grid-baseline) * 3);\n\t\tpadding-bottom: calc(var(--default-grid-baseline) * 3);\n\t}\n\n\t:deep(#smartpicker-select .vs__selected) {\n\t\tmargin-left: 0;\n\t}\n\n</style>\n","<template>\n  <span v-bind=\"$attrs\"\n        :aria-hidden=\"title ? null : 'true'\"\n        :aria-label=\"title\"\n        class=\"material-design-icon check-icon\"\n        role=\"img\"\n        @click=\"$emit('click', $event)\">\n    <svg :fill=\"fillColor\"\n         class=\"material-design-icon__svg\"\n         :width=\"size\"\n         :height=\"size\"\n         viewBox=\"0 0 24 24\">\n      <path d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\">\n        <title v-if=\"title\">{{ title }}</title>\n      </path>\n    </svg>\n  </span>\n</template>\n\n<script>\nexport default {\n  name: \"CheckIcon\",\n  emits: ['click'],\n  props: {\n    title: {\n      type: String,\n    },\n    fillColor: {\n      type: String,\n      default: \"currentColor\"\n    },\n    size: {\n      type: Number,\n      default: 24\n    }\n  }\n}\n</script>","<!--\n  - SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<template>\n\t<div class=\"picker-content\">\n\t\t<h2 class=\"picker-title\">\n\t\t\t{{ t('tables', 'Nextcloud Tables') }}\n\t\t</h2>\n\t\t<div class=\"selection-wrapper\">\n\t\t\t<div class=\"selection\">\n\t\t\t\t<div class=\"space-T space-B\">\n\t\t\t\t\t<Search :value.sync=\"value\" />\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"space-T space-B\">\n\t\t\t\t\t<h3>{{ t('tables', 'Render mode') }}</h3>\n\t\t\t\t\t<div class=\"radio\">\n\t\t\t\t\t\t<NcCheckboxRadioSwitch\n\t\t\t\t\t\t\t:checked.sync=\"renderMode\"\n\t\t\t\t\t\t\tvalue=\"link\"\n\t\t\t\t\t\t\tname=\"render-mode\"\n\t\t\t\t\t\t\ttype=\"radio\">\n\t\t\t\t\t\t\t<IconLink :size=\"20\" />{{ t('tables', 'Link') }}\n\t\t\t\t\t\t</NcCheckboxRadioSwitch>\n\t\t\t\t\t\t<NcCheckboxRadioSwitch\n\t\t\t\t\t\t\t:checked.sync=\"renderMode\"\n\t\t\t\t\t\t\tvalue=\"content\"\n\t\t\t\t\t\t\tname=\"render-mode\"\n\t\t\t\t\t\t\ttype=\"radio\">\n\t\t\t\t\t\t\t<IconText :size=\"20\" />{{ t('tables', 'Content') }}\n\t\t\t\t\t\t</NcCheckboxRadioSwitch>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div v-if=\"getLink\" class=\"space-T space-B\">\n\t\t\t\t\t<h3>{{ t('tables', 'Preview') }}</h3>\n\t\t\t\t\t<div class=\"preview space-T\">\n\t\t\t\t\t\t<div v-if=\"previewLoading\">\n\t\t\t\t\t\t\t<NcLoadingIcon />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-else>\n\t\t\t\t\t\t\t<LinkReferenceWidget v-if=\"renderMode === 'link'\" :rich-object=\"richObject\" />\n\t\t\t\t\t\t\t<ContentReferenceWidget v-if=\"renderMode === 'content'\" :rich-object=\"richObject\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<NcEmptyContent v-else>\n\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t<IconTables />\n\t\t\t\t\t</template>\n\t\t\t\t</NcEmptyContent>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"select-button\">\n\t\t\t<NcButton type=\"primary\" :disabled=\"value === null\" :aria-label=\"t('tables', 'Select')\" @click=\"selectReference\">\n\t\t\t\t<template #icon>\n\t\t\t\t\t<IconCheck :size=\"20\" />\n\t\t\t\t</template>\n\t\t\t\t{{ t('tables', 'Insert') }}\n\t\t\t</NcButton>\n\t\t</div>\n\t</div>\n</template>\n<script>\nimport { translate as t, translatePlural as n } from '@nextcloud/l10n'\nimport { NcButton, NcCheckboxRadioSwitch, NcEmptyContent, NcLoadingIcon } from '@nextcloud/vue'\nimport IconTables from '../shared/assets/icons/IconTables.vue'\nimport Search from './sections/Search.vue'\nimport IconLink from 'vue-material-design-icons/Link.vue'\nimport IconText from 'vue-material-design-icons/Text.vue'\nimport IconCheck from 'vue-material-design-icons/Check.vue'\nimport { generateUrl } from '@nextcloud/router'\nimport axios from '@nextcloud/axios'\nimport displayError from '../shared/utils/displayError.js'\nimport { useTablesStore } from '../store/store.js'\n\nexport default {\n\n\tcomponents: {\n\t\tIconTables,\n\t\tIconLink,\n\t\tIconText,\n\t\tIconCheck,\n\t\tNcEmptyContent,\n\t\tSearch,\n\t\tNcCheckboxRadioSwitch,\n\t\tNcButton,\n\t\tLinkReferenceWidget: import('./LinkReferenceWidget.vue'),\n\t\tContentReferenceWidget: import('./ContentReferenceWidget.vue'),\n\t\tNcLoadingIcon,\n\t},\n\n\tsetup() {\n\t\tconst tablesStore = useTablesStore()\n\t\treturn { tablesStore }\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\trenderMode: 'link', // { link, content }\n\t\t\tvalue: null,\n\t\t\tpreviewLoading: false,\n\t\t\trichObject: {},\n\t\t}\n\t},\n\n\tcomputed: {\n\t\tgetLink() {\n\t\t\tif (!this.value) {\n\t\t\t\treturn ''\n\t\t\t}\n\n\t\t\tconst suffix = this.renderMode === 'content' ? '/content' : ''\n\t\t\treturn window.location.protocol + '//' + window.location.host + generateUrl('/apps/tables/#/' + this.value?.type + '/' + this.value?.value + suffix)\n\t\t},\n\t},\n\n\twatch: {\n\t\trenderMode() {\n\t\t\tthis.updateContent()\n\t\t},\n\t\tvalue() {\n\t\t\tthis.updateRichObject()\n\t\t\tthis.updateContent()\n\t\t},\n\t},\n\n\tasync mounted() {\n\t\tif (!this.tablesStore) {\n\t\t\tconst { default: store } = await import(\n\t\t\t\t'../store/store.js')\n\t\t\tconst { default: data } = await import(\n\t\t\t\t'../store/data.js')\n\n\t\t\tthis.tablesStore = store\n\t\t\tthis.tablesStore.data = data\n\t\t}\n\t},\n\n\tmethods: {\n\t\tt,\n\t\tn,\n\t\tasync updateContent() {\n\t\t\tif (this.renderMode === 'content') {\n\t\t\t\tthis.previewLoading = true\n\n\t\t\t\tawait this.loadColumnsForContentPreview()\n\t\t\t\tawait this.loadRowsForContentPreview()\n\n\t\t\t\tthis.previewLoading = false\n\t\t\t} else {\n\t\t\t\tdelete this.richObject.rows\n\t\t\t\tdelete this.richObject.columns\n\t\t\t}\n\t\t},\n\t\tselectReference() {\n\t\t\tthis.$emit('submit', this.getLink)\n\t\t},\n\t\tupdateRichObject() {\n\t\t\tthis.richObject.emoji = this.value.emoji\n\t\t\tthis.richObject.link = this.getLink\n\t\t\tthis.richObject.ownerDisplayName = this.value.ownerDisplayName\n\t\t\tthis.richObject.ownership = this.value.owner\n\t\t\tthis.richObject.rowsCount = this.value.rowsCount\n\t\t\tthis.richObject.title = this.value.label\n\t\t\tthis.richObject.type = this.value.type\n\t\t\tthis.richObject.id = this.value.value\n\t\t},\n\t\tasync loadColumnsForContentPreview() {\n\t\t\tif (this.value === null) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst res = await axios.get(generateUrl('/apps/tables/api/1/' + this.value.type + 's/' + this.value.value + '/columns'))\n\t\t\t\tconsole.debug('columns from BE', res.data)\n\t\t\t\tthis.richObject.columns = res.data\n\t\t\t} catch (e) {\n\t\t\t\tdisplayError(e, t('tables', 'Could not fetch columns for content preview.'))\n\t\t\t}\n\t\t},\n\t\tasync loadRowsForContentPreview() {\n\t\t\tif (this.value === null) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst res = await axios.get(generateUrl('/apps/tables/row/' + this.value.type + '/' + this.value.value))\n\t\t\t\tconsole.debug('rows from BE', res.data)\n\t\t\t\tthis.richObject.rows = res.data\n\t\t\t} catch (e) {\n\t\t\t\tdisplayError(e, t('tables', 'Could not fetch rows for content preview.'))\n\t\t\t}\n\t\t},\n\t},\n\n}\n</script>\n<style scoped lang=\"scss\">\n\n\t.picker-content {\n\t\twidth: 100%;\n\t\tmin-height: 350px;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\toverflow-y: auto;\n\t\tpadding: 0 16px 16px 16px;\n\t}\n\n\t.picker-content > h2 {\n\t\tmargin: 12px 0;\n\t\ttext-align: center;\n\t}\n\n\th3 {\n\t\tmargin: 0;\n\t}\n\n\t.space-B {\n\t\tmargin-bottom: calc(var(--default-grid-baseline) * 4);\n\t}\n\n\t.space-T {\n\t\tmargin-top: calc(var(--default-grid-baseline) * 2);\n\t}\n\n\ttable {\n\t\twidth: 100%;\n\t}\n\n\ttable th, table td {\n\t\tborder: none !important;\n\t\twidth: 50%;\n\t\tpadding-left: calc(var(--default-grid-baseline) * 2);\n\t\tpadding-right: calc(var(--default-grid-baseline) * 2);\n\t}\n\n\t.radio {\n\t\tdisplay: flex;\n\t}\n\n\t.radio > span {\n\t\tpadding-right: calc(var(--default-grid-baseline) * 6);\n\t}\n\n\t.radio label .material-design-icon {\n\t\tpadding-right: calc(var(--default-grid-baseline) * 1);\n\t}\n\n\t.select-button {\n\t\tbottom: 0;\n\t\twidth: 100%;\n\t\tdisplay: flex;\n\t\talign-items: end;\n\t\tflex-direction: column;\n\t\tposition:sticky;\n\t}\n\n\t.selection-wrapper {\n\t\twidth: 100%;\n\t}\n\n\t.selection-wrapper .selection {\n\t\tmargin-left: auto;\n\t\tmargin-right: auto;\n\t\twidth: 550px;\n\t}\n\n\t.preview {\n\t\tborder: 2px solid var(--color-border);\n\t\tborder-radius: var(--border-radius-large);\n\t}\n\n</style>\n"],"file":"js/SmartPicker-BJa3HyOL.chunk.mjs"}