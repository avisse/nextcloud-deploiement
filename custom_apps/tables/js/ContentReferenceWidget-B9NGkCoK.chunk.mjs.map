{"version":3,"mappings":";;8uBAsCA,MAAAA,EAAA,CAEA,YACA,QAAAC,EACA,QAAAC,EACA,cAAAC,CACA,EAEA,QAAAC,CAAA,EAEA,OACA,gBACA,YACA,UACA,EACA,YACA,YACA,YACA,EACA,YACA,aACA,UACA,CACA,EAEA,OACA,OACA,eACA,UACA,YAAAC,EAAA,EACA,UAAAC,EAAA,CACA,CACA,EAEA,UACA,mBACA,OACA,0DACA,eACA,gDACA,kDACA,oBACA,kBACA,oBACA,kBACA,iBACA,kBACA,aACA,kDACA,CACA,EACA,eACA,sBACA,iBAAAC,GACAA,EAAA,UAAAC,GACA,OAAAA,EAAA,OACA,yBACA,CACA,EAEA,SAEA,CACA,EAEA,gBACAC,EAAA,SAAAC,GAAA,CACA,MAAAC,EAAAD,EAAA,GACA,OAAAE,CAAA,EAAAD,EAAA,YACA,uDAAAC,CAAA,KACA,GAEA,qBACA,EAEA,SACA,GAAAC,EAAAP,EAAA,8BACA,OAAAQ,EAAA,CACA,eAAAA,IAAA,GACA,WAAAA,EAAA,aACA,IACA,EACA,kBACA,cAAAC,CAAA,QAAAC,EAAA,wBAAAD,CAAA,gEAAAA,EAAA,+EACAE,EAAAF,EAAA,CACA,aACA,gCACA,8BACA,4BACA,OACA,MAAAG,EAAA,aACA,GAAAA,EAAA,yBACA,MAAAC,EAAAD,EAAA,OACA,eAAAC,CAAA,CACA,CACA,EACA,EACA,cAAAC,EAAA,CACA,cAAAC,CAAA,QAAAL,EAAA,wBAAAK,CAAA,8DAAAA,EAAA,gFACAJ,EAAAI,EAAA,CACA,aACA,gCACA,gBAAAD,CAAA,EACA,8BACA,uBACA,OACA,MAAAF,EAAA,aACAI,EAAA,oBAAAf,KAAA,KAAAa,CAAA,EACAG,EAAAL,EAAA,KAAAX,KAAA,KAAAa,CAAA,EACA,iBAAAE,EAAA,EAAAC,CAAA,CACA,EACA,EACA,OAAAH,EAAA,CACA,sBAAAb,KAAA,KAAAa,CAAA,CACA,EACA,iBACA,2BACA,0BACA,KAGA,uBAEA,CACA,CACA","names":["_sfc_main","NcTable","Options","NcLoadingIcon","permissionsMixin","useTablesStore","useDataStore","row","column","useResizeObserver","entries","entry","width","mapActions","searchString","CreateRow","__vitePreload","spawnDialog","storeRows","createdRow","rowId","EditRow","localRowIndex","updatedRow"],"ignoreList":[],"sources":["../src/views/ContentReferenceWidget.vue"],"sourcesContent":["<!--\n  - SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<template>\n\t<div v-if=\"richObject\" class=\"tables-content-widget\">\n\t\t<div class=\"header\">\n\t\t\t<h2>\n\t\t\t\t<NcLoadingIcon v-if=\"!rows\" :size=\"30\" />\n\t\t\t\t<span v-else>{{ richObject.emoji }}</span>&nbsp;{{ richObject.title }}\n\t\t\t</h2>\n\t\t\t<Options\n\t\t\t\t:config=\"tablePermissions\"\n\t\t\t\t:show-options=\"true\"\n\t\t\t\t@create-row=\"createRow\"\n\t\t\t\t@set-search-string=\"search\" />\n\t\t</div>\n\t\t<div v-if=\"rows\" class=\"nc-table\">\n\t\t\t<NcTable\n\t\t\t\t:rows=\"filteredRows\"\n\t\t\t\t:columns=\"richObject.columns\"\n\t\t\t\tv-bind=\"tablePermissions\"\n\t\t\t\t@edit-row=\"editRow\" />\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport NcTable from '../shared/components/ncTable/NcTable.vue'\nimport Options from '../shared/components/ncTable/sections/Options.vue'\nimport permissionsMixin from '../shared/components/ncTable/mixins/permissionsMixin.js'\nimport { NcLoadingIcon } from '@nextcloud/vue'\nimport { useResizeObserver } from '@vueuse/core'\nimport { spawnDialog } from '@nextcloud/dialogs'\nimport { useTablesStore } from '../store/store.js'\nimport { useDataStore } from '../store/data.js'\nimport { mapActions } from 'pinia'\n\nexport default {\n\n\tcomponents: {\n\t\tNcTable,\n\t\tOptions,\n\t\tNcLoadingIcon,\n\t},\n\n\tmixins: [permissionsMixin],\n\n\tprops: {\n\t\trichObjectType: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\trichObject: {\n\t\t\ttype: Object,\n\t\t\tdefault: null,\n\t\t},\n\t\taccessible: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tsearchExp: null,\n\t\t\trows: null,\n\t\t\ttablesStore: useTablesStore(),\n\t\t\tdataStore: useDataStore(),\n\t\t}\n\t},\n\n\tcomputed: {\n\t\ttablePermissions() {\n\t\t\treturn {\n\t\t\t\tcanCreateRows: this.canCreateRowInElement(this.richObject),\n\t\t\t\tcanReadRows: true,\n\t\t\t\tcanEditRows: this.canUpdateData(this.richObject),\n\t\t\t\tcanDeleteRows: this.canDeleteData(this.richObject),\n\t\t\t\tcanCreateColumns: false,\n\t\t\t\tcanEditColumns: false,\n\t\t\t\tcanDeleteColumns: false,\n\t\t\t\tcanDeleteTable: false,\n\t\t\t\tcanSelectRows: false,\n\t\t\t\tcanHideColumns: false,\n\t\t\t\tcanFilter: false,\n\t\t\t\tshowActions: this.canManageElement(this.richObject),\n\t\t\t}\n\t\t},\n\t\tfilteredRows() {\n\t\t\tif (this.searchExp) {\n\t\t\t\treturn this.rows.filter(row => {\n\t\t\t\t\treturn row.data.some(column => {\n\t\t\t\t\t\tconst col = String(column.value)\n\t\t\t\t\t\treturn col.search(this.searchExp) >= 0\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\treturn this.rows\n\t\t\t}\n\t\t},\n\t},\n\n\tasync mounted() {\n\t\tuseResizeObserver(this.$el, (entries) => {\n\t\t\tconst entry = entries[0]\n\t\t\tconst { width } = entry.contentRect\n\t\t\tthis.$el.style.setProperty('--widget-content-width', `${width}px`)\n\t\t})\n\n\t\tawait this.loadRows()\n\t},\n\n\tmethods: {\n\t\t...mapActions(useDataStore, ['loadRowsFromBE', 'getRows']),\n\t\tsearch(searchString) {\n\t\t\tthis.searchExp = (searchString !== '')\n\t\t\t\t? new RegExp(searchString.trim(), 'ig')\n\t\t\t\t: null\n\t\t},\n\t\tasync createRow() {\n\t\t\tconst { default: CreateRow } = await import('../modules/modals/CreateRow.vue')\n\t\t\tspawnDialog(CreateRow, {\n\t\t\t\tshowModal: true,\n\t\t\t\tcolumns: this.richObject.columns,\n\t\t\t\tisView: Boolean(this.richObject.type),\n\t\t\t\telementId: this.richObject.id,\n\t\t\t}, () => {\n\t\t\t\tconst storeRows = this.getRows\n\t\t\t\tif (storeRows.length > this.rows.length) {\n\t\t\t\t\tconst createdRow = storeRows.at(-1)\n\t\t\t\t\tthis.rows.push(createdRow)\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\tasync editRow(rowId) {\n\t\t\tconst { default: EditRow } = await import('../modules/modals/EditRow.vue')\n\t\t\tspawnDialog(EditRow, {\n\t\t\t\tshowModal: true,\n\t\t\t\tcolumns: this.richObject.columns,\n\t\t\t\trow: this.getRow(rowId),\n\t\t\t\tisView: Boolean(this.richObject.type),\n\t\t\t\telement: this.richObject,\n\t\t\t}, () => {\n\t\t\t\tconst storeRows = this.getRows\n\t\t\t\tconst localRowIndex = this.rows.findIndex(row => row.id === rowId)\n\t\t\t\tconst updatedRow = storeRows.find(row => row.id === rowId)\n\t\t\t\tthis.rows.splice(localRowIndex, 1, updatedRow)\n\t\t\t})\n\t\t},\n\t\tgetRow(rowId) {\n\t\t\treturn this.rows.find(row => row.id === rowId)\n\t\t},\n\t\tasync loadRows() {\n\t\t\tconst res = await this.loadRowsFromBE({\n\t\t\t\ttableId: this.richObject.id,\n\t\t\t})\n\n\t\t\tif (res) {\n\t\t\t\tthis.rows = this.getRows\n\t\t\t}\n\t\t},\n\t},\n}\n</script>\n<style lang=\"scss\" scoped>\n\n\t.tables-content-widget {\n\t\tmin-height: max(50vh, 200px);\n\t\theight: 50vh;\n\t\toverflow: scroll;\n\n\t\t& .header {\n\t\t\tposition: sticky;\n\t\t\ttop: 0;\n\t\t\tleft: 0;\n\t\t\tz-index: 1;\n\n\t\t\t:where(.options) {\n\t\t\t\tposition: sticky;\n\t\t\t\ttop: 57px;\n\t\t\t\tz-index: 1;\n\t\t\t\tpadding-bottom: 10px;\n\t\t\t\tbackground-color: var(--color-main-background);\n\t\t\t}\n\n\t\t\th2 {\n\t\t\t\tposition: sticky;\n\t\t\t\ttop: 0;\n\t\t\t\tmin-width: var(--widget-content-width);\n\t\t\t\tz-index: 1;\n\t\t\t\tbackground-color: var(--color-main-background);\n\t\t\t\tmargin: 0 !important;\n\t\t\t\tpadding: calc(var(--default-grid-baseline) * 4);\n\n\t\t\t\t& .loading-icon {\n\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\tvertical-align: middle;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t.nc-table {\n\t\t\tmin-width: var(--widget-content-width);\n\n\t\t\t:where(.options.row) {\n\t\t\t\tdisplay: none;\n\t\t\t}\n\n\t\t\t:where(thead) {\n\t\t\t\tposition: sticky;\n\t\t\t\ttop: 117px;\n\n\t\t\t\t:where(.cell-wrapper) {\n\t\t\t\t\tmin-width: 150px;\n\t\t\t\t\tmax-width: 200px;\n\t\t\t\t}\n\n\t\t\t\t:where(.sticky) {\n\t\t\t\t\tbackground: transparent !important;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t:where(.pagination-footer) {\n\t\t\t\twidth: unset !important;\n\t\t\t\tleft: unset !important;\n\t\t\t}\n\t\t}\n\n\t\t& :deep(.options.row) {\n\t\t\twidth: calc(var(--widget-content-width, 100%) - 12px);\n\t\t}\n\t}\n\n</style>\n"],"file":"js/ContentReferenceWidget-B9NGkCoK.chunk.mjs"}