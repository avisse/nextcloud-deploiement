/*! third party licenses: js/vendor.LICENSE.txt */
import{i as c,e as p,f as m}from"./useFormatDateTime-AjHnUuIE.chunk.mjs";import{i as a,k as b,f as u,_ as l}from"./NcNoteCard-DG3F-LUj.chunk.mjs";import{n as d,f as w}from"./_plugin-vue2_normalizer-oRdohoZe.chunk.mjs";import{c as o}from"./index-BmkWHhSR.chunk.mjs";import"./index-56SXuvlv-Ca_OzF4R.chunk.mjs";import{N as f}from"./index-Cpd69PGH.chunk.mjs";import{s as i}from"./_plugin-vue2_normalizer-jrlE7CJU-B-cIoeGj.chunk.mjs";import{R as h}from"./RowFormWrapper-CzNjoOJe.chunk.mjs";import{I as g}from"./ImportResults-DHWjszdi.chunk.mjs";import"./vue.runtime.esm-DBajT-mq.chunk.mjs";import"./public-0fz1q1qH.chunk.mjs";const y={name:"FileActionImport",components:{NcButton:u,NcDialog:m,ImportResults:g,NcLoadingIcon:b,NcSelect:p,NcCheckboxRadioSwitch:c,NcEmojiPicker:w,RowFormWrapper:h},props:{file:{type:f,default:null}},data(){return{importAsNew:!0,createMissingColumns:!0,loadingTables:!1,importingFile:!1,newTable:{emoji:"ðŸ”§",title:this.file.basename},existingTables:[],selectedTable:null,importResults:null,showResultsDialog:!0}},computed:{tableOptions(){return this.existingTables.map(t=>({label:`${t.emoji} ${t.title}`,value:t.id}))??"No existing tables"}},async mounted(){this.loadingTables=!0;const t=await o.get(l("/apps/tables/table"));t.data&&t.data.forEach(e=>this.existingTables.push({title:e.title,emoji:e.emoji,id:e.id})),this.loadingTables=!1},methods:{t:a,selectIcon(t){this.newTable.emoji=t},setNewTableTitle(t){this.newTable.title=t.srcElement.value},closeResultsDialog(){this.showResultsDialog=!1},async importFile(){if(this.importingFile=!0,this.importAsNew)this.importResults=await x(this.newTable.title,this.newTable.emoji,this.file),this.importResults||i(a("tables","Could not create table"));else{if(!this.selectedTable){i(a("tables","You must select an existing table"));return}this.importResults=await T(this.selectedTable.value,this.file,this.createMissingColumns),this.importResults||i(a("tables","Could not import data to table"))}this.importingFile=!1},closeImportDialog(){this.$emit("close")}}};async function x(t,e,s){const n=await N(t,e);return n?await r(n.id,s.path,!0):!1}async function T(t,e,s){return await r(t,e.path,s)}async function N(t,e){return(await o.post(l("/apps/tables/table"),{title:t,emoji:e,template:"custom"})).data}async function r(t,e,s){return(await o.post(l(`/apps/tables/import/table/${t}`),{path:e,createMissingColumns:s})).data}var R=function(){var t=this,e=t._self._c;return t.importResults?e("NcDialog",{attrs:{name:t.t("tables","Import successful"),open:t.showResultsDialog,size:"small"},on:{"update:open":function(s){t.showResultsDialog=s}},scopedSlots:t._u([{key:"actions",fn:function(){return[e("NcButton",{attrs:{"aria-label":t.t("tables","Close")},on:{click:function(s){return t.closeResultsDialog()}}},[t._v(" "+t._s(t.t("tables","Close"))+" ")])]},proxy:!0}])},[e("ImportResults",{attrs:{results:t.importResults}})],1):e("NcDialog",{attrs:{name:t.t("tables","Import file into Tables"),size:"normal"},on:{closing:t.closeImportDialog}},[e("div",{staticClass:"modal__content"},[e("RowFormWrapper",{staticClass:"row",attrs:{title:t.t("tables","Import as new table"),description:t.t("tables","This will create a new table from the data in this file.")}},[e("div",{staticStyle:{display:"flex","flex-flow":"row wrap","align-items":"center"}},[e("NcCheckboxRadioSwitch",{staticClass:"switch",staticStyle:{"flex-grow":"0"},attrs:{"data-cy":"importAsNewTableSwitch","aria-label":t.t("tables","Import as new table"),checked:t.importAsNew,type:"switch"},on:{"update:checked":function(s){t.importAsNew=s}}},[t._v(" "+t._s(t.t("tables","Import as new table"))+" ")]),e("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","flex-grow":"1"}},[e("NcEmojiPicker",{attrs:{"close-on-select":!0},on:{select:t.selectIcon}},[e("NcButton",{attrs:{"aria-label":t.t("tables","Select emoji for table"),type:"tertiary",disabled:!t.importAsNew},on:{click:function(s){s.preventDefault()}},scopedSlots:t._u([{key:"icon",fn:function(){return[t._v(" "+t._s(t.newTable.emoji)+" ")]},proxy:!0}],null,!1,808473299)})],1),e("input",{staticStyle:{"flex-grow":"1"},attrs:{"aria-label":t.t("tables","Title of the new table"),placeholder:t.newTable.title,disabled:!t.importAsNew},on:{input:t.setNewTableTitle}})],1)],1)]),e("RowFormWrapper",{staticClass:"row",attrs:{title:t.t("tables","Import into existing table"),description:t.t("tables","This will import the data from this file into an already existing table.")}},[e("div",{staticStyle:{display:"flex","flex-flow":"row nowrap",margin:"20px 0"}},[e("NcSelect",{staticStyle:{"flex-grow":"1"},attrs:{"data-cy":"selectExistingTableDropdown",options:t.tableOptions,"aria-label-combobox":t.t("tables","Select the table to import into"),placeholder:t.t("tables","Select an existing table"),disabled:t.importAsNew,loading:t.loadingTables},model:{value:t.selectedTable,callback:function(s){t.selectedTable=s},expression:"selectedTable"}})],1)]),e("NcCheckboxRadioSwitch",{staticStyle:{"flex-grow":"0"},attrs:{"aria-label":t.t("tables","Create missing columns"),type:"switch",disabled:t.importAsNew,checked:t.createMissingColumns},on:{"update:checked":function(s){t.createMissingColumns=s}}},[t._v(" "+t._s(t.t("tables","Create missing columns"))+" ")]),e("div",{staticClass:"end"},[e("NcButton",{attrs:{"data-cy":"fileActionImportButton","aria-label":t.t("tables","Import"),type:"primary",disabled:t.importingFile},on:{click:t.importFile},scopedSlots:t._u([t.importingFile?{key:"icon",fn:function(){return[e("NcLoadingIcon",{attrs:{size:20}})]},proxy:!0}:null],null,!0)},[t._v(" "+t._s(t.t("tables","Import"))+" ")])],1)],1)])},C=[],I=d(y,R,C,!1,null,"a18ba619");const $=I.exports;export{$ as default};
//# sourceMappingURL=FileActionImport-BkNdl0eQ.chunk.mjs.map
