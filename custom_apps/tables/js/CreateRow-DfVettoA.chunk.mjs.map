{"version":3,"mappings":";;o0BAmDA,MAAAA,EAAA,CACA,iBACA,YACA,SAAAC,EACA,oBAAAC,EACA,sBAAAC,EACA,WAAAC,EACA,SAAAC,CACA,EACA,QAAAC,CAAA,EACA,OACA,WACA,aACA,UACA,EACA,SACA,WACA,YACA,EACA,QACA,aACA,UACA,EACA,WACA,YACA,YACA,CACA,EACA,OACA,OACA,OACA,gBACA,mBACA,iBAAAC,CACA,CACA,EACA,UACA,iBACA,2BAAAC,KAAA,MACA,EACA,wBACA,0CACA,EACA,wBACA,gCAAAA,KAAA,sDAAAA,EAAA,KACA,CACA,EACA,OACA,YACA,gBACA,oBACA,wCACA,EAEA,CACA,EACA,SACA,GAAAC,EAAAC,EAAA,kBACA,EAAAC,EACA,eACA,aACA,wBACA,mBACA,EACA,sBACA,qBACA,4BACA,qBACA,sBAGAC,EAAAD,EAAA,uCACA,cAHA,mBAKA,EACA,uBACA,sBACA,cAAAE,CAAA,QAAAC,EAAA,wBAAAD,CAAA,4DAAAA,EAAA,kDACA,iBAAAA,CACA,CAEA,IACA,MAAAE,EAAA,GACA,UAAAC,EAAAC,CAAA,6BACAF,EAAAC,CAAA,EAAAC,EAEA,yBACA,uCACA,wCACA,KAAAF,CACA,EACA,OAAAG,EAAA,CACA,cAAAA,CAAA,EACAC,EAAAR,EAAA,qCACA,CACA,EACA,QACA,WACA,EACA,UAAAS,EAAA,CACAA,EAAA,eAAAA,EAAA,SACA,oBAEA,CACA,CACA","names":["_sfc_main","NcDialog","ColumnFormComponent","NcCheckboxRadioSwitch","NcNoteCard","NcButton","rowHelper","ALLOWED_PROTOCOLS","col","mapActions","useDataStore","t","showSuccess","store","__vitePreload","data","key","value","e","showError","event"],"ignoreList":[],"sources":["../src/modules/modals/CreateRow.vue"],"sourcesContent":["<!--\n  - SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<template>\n\t<NcDialog v-if=\"showModal\"\n\t\t:name=\"t('tables', 'Create row')\"\n\t\tsize=\"large\"\n\t\tdata-cy=\"createRowModal\"\n\t\t@closing=\"actionCancel\">\n\t\t<div class=\"modal__content\" @keydown=\"onKeydown\">\n\t\t\t<div v-for=\"column in nonMetaColumns\" :key=\"column.id\" :data-cy=\"column.title\">\n\t\t\t\t<ColumnFormComponent\n\t\t\t\t\t:column=\"column\"\n\t\t\t\t\t:value.sync=\"row[column.id]\" />\n\t\t\t\t<NcNoteCard v-if=\"column.mandatory && !isValueValidForColumn(row[column.id], column)\"\n\t\t\t\t\ttype=\"error\">\n\t\t\t\t\t{{ t('tables', '\"{columnTitle}\" should not be empty', { columnTitle: column.title }) }}\n\t\t\t\t</NcNoteCard>\n\t\t\t\t<NcNoteCard v-if=\"row[column.id] && column.type === 'text-link' && !isValidUrlProtocol(row[column.id])\"\n\t\t\t\t\ttype=\"error\">\n\t\t\t\t\t{{ t('tables', 'Invalid protocol. Allowed: {allowed}', {allowed: allowedProtocols.join(', ')}) }}\n\t\t\t\t</NcNoteCard>\n\t\t\t</div>\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"fix-col-4 space-T end\">\n\t\t\t\t\t<div class=\"padding-right\">\n\t\t\t\t\t\t<NcCheckboxRadioSwitch :checked.sync=\"addNewAfterSave\" type=\"switch\" data-cy=\"createRowAddMoreSwitch\">\n\t\t\t\t\t\t\t{{ t('tables', 'Add more') }}\n\t\t\t\t\t\t</NcCheckboxRadioSwitch>\n\t\t\t\t\t</div>\n\t\t\t\t\t<NcButton v-if=\"!localLoading\" class=\"primary\" :aria-label=\"t('tables', 'Save row')\" :disabled=\"hasEmptyMandatoryRows || hasInvalidUrlProtocol\" data-cy=\"createRowSaveButton\" @click=\"actionConfirm()\">\n\t\t\t\t\t\t{{ t('tables', 'Save') }}\n\t\t\t\t\t</NcButton>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</NcDialog>\n</template>\n\n<script>\nimport { NcDialog, NcCheckboxRadioSwitch, NcNoteCard, NcButton } from '@nextcloud/vue'\nimport { showError, showSuccess } from '@nextcloud/dialogs'\nimport '@nextcloud/dialogs/style.css'\nimport ColumnFormComponent from '../main/partials/ColumnFormComponent.vue'\nimport { translate as t } from '@nextcloud/l10n'\nimport rowHelper from '../../shared/components/ncTable/mixins/rowHelper.js'\nimport { useDataStore } from '../../store/data.js'\nimport { mapActions } from 'pinia'\nimport { ALLOWED_PROTOCOLS } from '../../shared/constants.ts'\n\nexport default {\n\tname: 'CreateRow',\n\tcomponents: {\n\t\tNcDialog,\n\t\tColumnFormComponent,\n\t\tNcCheckboxRadioSwitch,\n\t\tNcNoteCard,\n\t\tNcButton,\n\t},\n\tmixins: [rowHelper],\n\tprops: {\n\t\tshowModal: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tcolumns: {\n\t\t\ttype: Array,\n\t\t\tdefault: null,\n\t\t},\n\t\tisView: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\telementId: {\n\t\t\ttype: Number,\n\t\t\tdefault: null,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\trow: {},\n\t\t\tlocalLoading: false,\n\t\t\taddNewAfterSave: false,\n\t\t\tallowedProtocols: ALLOWED_PROTOCOLS,\n\t\t}\n\t},\n\tcomputed: {\n\t\tnonMetaColumns() {\n\t\t\treturn this.columns.filter(col => col.id >= 0)\n\t\t},\n\t\thasEmptyMandatoryRows() {\n\t\t\treturn this.checkMandatoryFields(this.row)\n\t\t},\n\t\thasInvalidUrlProtocol() {\n\t\t\treturn this.nonMetaColumns.some(col => col.type === 'text-link' && !this.isValidUrlProtocol(this.row[col.id]))\n\t\t},\n\t},\n\twatch: {\n\t\tshowModal() {\n\t\t\tif (this.showModal) {\n\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\tthis.$el.querySelector('input')?.focus()\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t},\n\tmethods: {\n\t\t...mapActions(useDataStore, ['insertNewRow']),\n\t\tt,\n\t\tactionCancel() {\n\t\t\tthis.reset()\n\t\t\tthis.addNewAfterSave = false\n\t\t\tthis.$emit('close')\n\t\t},\n\t\tasync actionConfirm() {\n\t\t\tthis.localLoading = true\n\t\t\tawait this.sendNewRowToBE()\n\t\t\tthis.localLoading = false\n\t\t\tif (!this.addNewAfterSave) {\n\t\t\t\tthis.actionCancel()\n\t\t\t} else {\n\t\t\t\tshowSuccess(t('tables', 'Row successfully created.'))\n\t\t\t\tthis.reset()\n\t\t\t}\n\t\t},\n\t\tasync sendNewRowToBE() {\n\t\t\tif (!this.tablesStore) {\n\t\t\t\tconst { default: store } = await import('../../store/store.js')\n\t\t\t\tthis.tablesStore = store\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst data = {}\n\t\t\t\tfor (const [key, value] of Object.entries(this.row)) {\n\t\t\t\t\tdata[key] = value\n\t\t\t\t}\n\t\t\t\tawait this.insertNewRow({\n\t\t\t\t\tviewId: this.isView ? this.elementId : null,\n\t\t\t\t\ttableId: !this.isView ? this.elementId : null,\n\t\t\t\t\tdata,\n\t\t\t\t})\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e)\n\t\t\t\tshowError(t('tables', 'Could not create new row'))\n\t\t\t}\n\t\t},\n\t\treset() {\n\t\t\tthis.row = {}\n\t\t},\n\t\tonKeydown(event) {\n\t\t\tif (event.key === 'Enter' && event.ctrlKey) {\n\t\t\t\tthis.actionConfirm()\n\t\t\t}\n\t\t},\n\t},\n}\n</script>\n<style lang=\"scss\" scoped>\n.modal-mask {\n\tz-index: 2001;\n}\n\n.modal__content {\n\tpadding: 20px;\n\n\t.row .space-T,\n\t.row.space-T {\n\t\tpadding-top: 20px;\n\t}\n\n\t:where([class*='fix-col-']) {\n\t\tdisplay: flex;\n\t}\n\n\t:where(.slot) {\n\t\talign-items: baseline;\n\t}\n\n\t:where(.end) {\n\t\tjustify-content: end;\n\t}\n\n\t:where(.slot.fix-col-2) {\n\t\tmin-width: 50%;\n\t}\n\n\t:where(.fix-col-3) {\n\t\tdisplay: inline-block;\n\t}\n\n\t:where(.slot.fix-col-4 input, .slot.fix-col-4 .row) {\n\t\tmin-width: 100% !important;\n\t}\n\n\t:where(.name-parts) {\n\t\tdisplay: block !important;\n\t\tmax-width: fit-content !important;\n\t}\n}\n\n.padding-right {\n\tpadding-right: calc(var(--default-grid-baseline) * 3);\n}\n\n</style>\n"],"file":"js/CreateRow-DfVettoA.chunk.mjs"}